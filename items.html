<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Items - Anime Crusaders Wiki</title>
    <link rel="preload" href="favicon.ico" as="image" type="image/x-icon">
    <link rel="preload" href="data/items.json" as="fetch" crossorigin>
    <link rel="icon" type="image/x-icon" href="favicon.ico" crossorigin>
    <link rel="stylesheet" href="styles/style.css">
    <script src="scripts/common.js"></script>
    <script>
        async function loadItems() {
            const container = document.getElementById('itemsList');
            
            try {
                // Extract image URLs from items data
                const imageUrlsExtractor = (data) => {
                    return data.items.map(item => `images/items/${item.image}`);
                };

                // Load data using common function
                const data = await loadData(
                    CACHE_KEYS.ITEMS,
                    'data/items.json',
                    imageUrlsExtractor
                );

                // Clear existing content
                container.innerHTML = '';
                
                // Add each item to the container
                data.items.forEach(item => {
                    const itemCard = document.createElement('div');
                    itemCard.className = 'unit-card interactive-card';
                    itemCard.title = item.name;
                    
                    const img = document.createElement('img');
                    img.src = `images/items/${item.image}`;
                    img.alt = item.name;
                    img.loading = 'lazy';
                    
                    itemCard.appendChild(img);
                    container.appendChild(itemCard);
                });

                // Set up search functionality
                const searchBox = document.getElementById('itemSearch');
                searchBox.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const items = container.getElementsByClassName('unit-card');
                    
                    Array.from(items).forEach(item => {
                        const itemName = item.title.toLowerCase();
                        item.style.display = itemName.includes(searchTerm) ? '' : 'none';
                    });
                });

            } catch (error) {
                console.error('Error loading items:', error);
                container.innerHTML = '<p style="text-align: center; color: #ff4444;">Error loading items. Please try again later.</p>';
            }
        }

        // Add preload for items data
        addPreloadLink('data/items.json');

        // Load items when the page is ready
        ensureScriptLoaded(loadItems);
    </script>
</head>
<body>
    <header>
        <div class="logo">
            <img src="/images/logo.webp" alt="Anime Crusaders Logo">
        </div>
        <p class="subtitle">Anime Crusaders Wiki</p>
    </header>

    <nav>
        <a href="/">Home</a>
        <a href="units.html">Units</a>
        <a href="traits.html">Traits</a>
        <a href="items.html" class="active">Items</a>
        <a href="tierlist.html">Tier List</a>
        <a href="codes.html">Codes</a>
        <a href="update_log.html">Update Log</a>
    </nav>

    <div class="container">
        <div class="section">
            <h2>ðŸŽ¯ Items (Work In Progress)</h2>
            <div class="search-container">
                <input type="text" id="itemSearch" placeholder="Search items..." class="search-box">
            </div>
            <div class="tier-units" id="itemsList">
                <!-- Items will be loaded here dynamically -->
            </div>
        </div>
    </div>

    <footer>
        <p>Anime Crusaders Wiki by Raksha</p>
    </footer>
</body>
</html>