<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traits - Anime Crusaders Wiki</title>
    <link rel="preload" href="favicon.ico" as="image" type="image/x-icon">
    <link rel="preload" href="data/traits.json" as="fetch" crossorigin>
    <link rel="icon" type="image/x-icon" href="favicon.ico" crossorigin>
    <link rel="stylesheet" href="styles/style.css">
    <script src="scripts/common.js"></script>
    <script>
        async function loadTraits() {
            const traitsContainer = document.getElementById('traits-container');
            
            try {
                // Extract image URLs from trait data
                const imageUrlsExtractor = (data) => {
                    return data.traits.map(trait => `images/traits/${trait.image}`);
                };

                // Load data using common function with cache bypass
                const data = await loadData(
                    CACHE_KEYS.TRAITS,
                    'data/traits.json',
                    imageUrlsExtractor,
                    true // bypass cache
                );

                // Sort traits by odds (descending)
                data.traits.sort((a, b) => b.odds - a.odds);

                // Clear existing content
                traitsContainer.innerHTML = '';
                
                // Add each trait to the grid
                data.traits.forEach(trait => {
                    const traitCard = document.createElement('div');
                    traitCard.className = 'trait-card';
                    
                    // Format description by splitting into tiers
                    const tiers = trait.description.split('\n').map(tier => {
                        if (tier.startsWith('Tier')) {
                            const [tierNum, effect] = tier.split(': ');
                            return `<div class="tier-effect"><span class="tier-number">${tierNum}:</span> ${effect}</div>`;
                        }
                        return `<div class="trait-effect">${tier}</div>`;
                    }).join('');

                    traitCard.innerHTML = `
                        <div class="trait-icon">
                            <img src="images/traits/${trait.image}" alt="${trait.name} Trait" loading="lazy">
                        </div>
                        <div class="trait-name">${trait.name}</div>
                        <div class="trait-odds">${trait.odds}%</div>
                        <div class="trait-description">
                            ${tiers}
                        </div>
                    `;
                    traitsContainer.appendChild(traitCard);
                });

            } catch (error) {
                console.error('Error loading traits:', error);
                traitsContainer.innerHTML = '<div class="error-message">Error loading traits data.</div>';
            }
        }

        // Add preload for traits data
        addPreloadLink('data/traits.json');

        // Load traits when the page is ready
        ensureScriptLoaded(loadTraits);
    </script>
</head>
<body>
    <header>
        <div class="logo">
            <img src="images/logo.webp" alt="Anime Crusaders Logo">
        </div>
        <p class="subtitle">Anime Crusaders Wiki</p>
    </header>

    <nav>
        <a href="/acwiki">Home</a>
        <a href="units">Units</a>
        <a href="traits" class="active">Traits</a>
        <a href="items">Items</a>
        <a href="tierlist">Tier List</a>
        <a href="codes">Codes</a>
        <a href="update_logs">Update Logs</a>
        <a href="feedback">Feedback</a>
    </nav>

    <div class="container">
        <div class="section">
            <h2>âœ¨ Traits</h2>
            <div class="traits-grid">
                <div id="traits-container"></div>
            </div>
        </div>
    </div>

    <footer>
        <p>Anime Crusaders Wiki by Raksha</p>
    </footer>
</body>
</html>