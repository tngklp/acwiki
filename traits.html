<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traits - Anime Crusaders Wiki</title>
    <link rel="preload" href="favicon.ico" as="image" type="image/x-icon">
    <link rel="preload" href="data/traits.json" as="fetch" crossorigin>
    <link rel="icon" type="image/x-icon" href="favicon.ico" crossorigin>
    <link rel="stylesheet" href="styles/style.css">
    <script src="scripts/common.js"></script>
    <script>
        async function loadTraits() {
            const tbody = document.querySelector('.traits-table tbody');
            
            try {
                // Extract image URLs from trait data
                const imageUrlsExtractor = (data) => {
                    return data.traits.map(trait => `images/traits/${trait.image}`);
                };

                // Load data using common function with cache bypass
                const data = await loadData(
                    CACHE_KEYS.TRAITS,
                    'data/traits.json',
                    imageUrlsExtractor,
                    true // bypass cache
                );

                // Sort traits by odds (descending)
                data.traits.sort((a, b) => b.odds - a.odds);

                // Clear existing content
                tbody.innerHTML = '';
                
                // Add each trait to the table
                data.traits.forEach(trait => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${trait.name}</td>
                        <td><img src="images/traits/${trait.image}" alt="${trait.name} Trait" loading="lazy"></td>
                        <td>${trait.tier}</td>
                        <td>${trait.odds}%</td>
                        <td>${trait.description.replace(/\n/g, '<br>')}</td>
                    `;
                    tbody.appendChild(tr);
                });

            } catch (error) {
                console.error('Error loading traits:', error);
                displayTableError(tbody, 5);
            }
        }

        // Add preload for traits data
        addPreloadLink('data/traits.json');

        // Load traits when the page is ready
        ensureScriptLoaded(loadTraits);
    </script>
</head>
<body>
    <header>
        <div class="logo">
            <img src="/images/logo.webp" alt="Anime Crusaders Logo">
        </div>
        <p class="subtitle">Anime Crusaders Wiki</p>
    </header>

    <nav>
        <a href="/">Home</a>
        <a href="units.html">Units</a>
        <a href="traits.html" class="active">Traits</a>
        <a href="items.html">Items</a>
        <a href="tierlist.html">Tier List</a>
        <a href="codes.html">Codes</a>
        <a href="update_log.html">Update Log</a>
    </nav>

    <div class="container">
        <div class="section">
            <h2>âœ¨ Traits</h2>
            <div class="table-container">
                <table class="traits-table">
                    <thead>
                        <tr>
                            <th>Trait Name</th>
                            <th>Image</th>
                            <th>Tier</th>
                            <th>Odds</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="5" style="text-align: center;">Loading traits data...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer>
        <p>Anime Crusaders Wiki by Raksha</p>
    </footer>
</body>
</html>